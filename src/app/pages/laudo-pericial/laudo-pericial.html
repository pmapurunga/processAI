<div class="container">
  @if (laudo$ | async; as laudo) {
    @if(laudo) {
      <mat-card>
        <mat-card-header>
          <mat-card-title>Laudo Pericial</mat-card-title>
          <mat-card-subtitle>Processo Nº: {{ laudo.identificacaoProcesso?.PROCESSO_NUM }}</mat-card-subtitle>
          <mat-card-subtitle>NOME: {{ laudo.identificacaoProcesso?.NOME_PERICIANDO }}</mat-card-subtitle>
        </mat-card-header>
        <mat-card-actions>
          <button mat-raised-button color="primary" (click)="copyJsonToClipboard()">
            <mat-icon>content_copy</mat-icon>
            Copiar JSON
          </button>
          <button mat-raised-button color="accent" (click)="copyPromptToClipboard()">
            <mat-icon>file_copy</mat-icon>
            Copiar Prompt
          </button>
        </mat-card-actions>
        <mat-card-content>
          <mat-accordion>
            <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title>1. Identificação do Processo</mat-panel-title>
              </mat-expansion-panel-header>
              <p><strong>JUÍZO:</strong> {{ laudo.identificacaoProcesso?.JUIZO }}</p>
              <p><strong>NOME DO(A) PERICIANDO(A):</strong> {{ laudo.identificacaoProcesso?.NOME_PERICIANDO }}</p>
              <p><strong>DATA DO EXAME:</strong> {{ laudo.identificacaoProcesso?.DATA_EXAME }}</p>
            </mat-expansion-panel>

            <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title>2. Dados do(a) Periciando(a)</mat-panel-title>
              </mat-expansion-panel-header>
              <p><strong>DATA DE NASCIMENTO:</strong> {{ laudo.dadosPericiando?.DATA_NASCIMENTO }}</p>
              <p><strong>SEXO:</strong> {{ laudo.dadosPericiando?.SEXO }}</p>
              <p><strong>ESTADO CIVIL:</strong> {{ laudo.dadosPericiando?.ESTADO_CIVIL }}</p>
              <p><strong>ESCOLARIDADE:</strong> {{ laudo.dadosPericiando?.ESCOLARIDADE }}</p>
            </mat-expansion-panel>

            <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title>3. Histórico Laboral</mat-panel-title>
              </mat-expansion-panel-header>
              <p><strong>Função Habitual/Atual:</strong> {{ laudo.historicoLaboral?.FUNCAO_HABITUAL_ATUAL?.descricao }}</p>
              <markdown [data]="laudo.historicoLaboral?.HISTORICO_OCUPACIONAL_COMPLETO"></markdown>
              <h4>Experiências Laborais Anteriores:</h4>
              @for(exp of laudo.historicoLaboral?.EXPERIENSOAIS_LABORAIS_ANTERIORES; track exp) {
                <p>{{ exp.funcao }} ({{ exp.periodo }})</p>
              }
            </mat-expansion-panel>

            <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title>4. Dados Médicos</mat-panel-title>
              </mat-expansion-panel-header>
              <markdown [data]="laudo.dadosMedicos?.HISTORIA_CLINICA"></markdown>
              <markdown [data]="laudo.dadosMedicos?.EXAMES"></markdown>
              <markdown [data]="laudo.dadosMedicos?.EXAME_CLINICO"></markdown>
            </mat-expansion-panel>
            <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title>5. Obsevações</mat-panel-title>
              </mat-expansion-panel-header>            
              <markdown [data]="laudo.OBSERVACOES"></markdown>              
            </mat-expansion-panel>
            <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title>6. Respostas aos Quesitos</mat-panel-title>
              </mat-expansion-panel-header>
              @for (quesito of objectKeys(laudo.respostasQuesitos); track quesito) {
                <p><strong>{{ quesito }}:</strong> {{ laudo.respostasQuesitos[quesito] }}</p>
              }
            </mat-expansion-panel>
          </mat-accordion>
        </mat-card-content>
        <mat-card-footer>
          <p>Laudo emitido em {{ laudo.dadosLaudo?.DIA_LAUDO }}/{{ laudo.dadosLaudo?.MES_LAUDO }}/{{ laudo.dadosLaudo?.ANO_LAUDO }}</p>
        </mat-card-footer>
      </mat-card>
    } @else {
      <mat-card>
        <mat-card-content>
          <p>Nenhum laudo encontrado para este processo.</p>
        </mat-card-content>
      </mat-card>
    }
  } @else {
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
  }
</div>
