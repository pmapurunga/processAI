<mat-sidenav-container class="sidenav-container">

  <mat-sidenav mode="side" opened class="sidenav">
    <div class="sidenav-header">
      <h2>Modelos</h2>
      <button mat-mini-fab color="primary" (click)="startCreation()" matTooltip="Importar JSON">
        <mat-icon>add</mat-icon>
      </button>
    </div>

    <mat-nav-list>
      <a mat-list-item 
         *ngFor="let modelo of modelos$ | async"
         (click)="selectModelo(modelo)"
         [activated]="selectedModelo?.id === modelo.id">
        <mat-icon matListItemIcon>description</mat-icon>
        <span matListItemTitle>{{ modelo.titulo }}</span>
        <span matListItemLine>{{ modelo.jurisdicao }} - {{ modelo.tipoAcao }}</span>
      </a>
    </mat-nav-list>
  </mat-sidenav>

  <mat-sidenav-content class="content-area">

    <div *ngIf="isCreating" class="editor-container fade-in">
      <mat-card class="editor-card">
        <mat-card-header>
          <mat-icon mat-card-avatar>code</mat-icon>
          <mat-card-title>Importar Novo Modelo</mat-card-title>
          <mat-card-subtitle>Cole o objeto JSON padronizado abaixo</mat-card-subtitle>
        </mat-card-header>
        
        <mat-card-content>
          <mat-form-field appearance="outline" class="full-width-input">
            <mat-label>JSON do Modelo</mat-label>
            <textarea matInput 
                      [(ngModel)]="jsonInput" 
                      rows="20" 
                      placeholder='{ "titulo": "...", "quesitos": [] }'
                      spellcheck="false"></textarea>
          </mat-form-field>
        </mat-card-content>

        <mat-card-actions align="end">
          <button mat-button (click)="selectedModelo = null; isCreating = false">Cancelar</button>
          <button mat-raised-button color="primary" (click)="saveFromJson()">
            <mat-icon>save</mat-icon>
            Salvar Modelo
          </button>
        </mat-card-actions>
      </mat-card>
    </div>

    <div *ngIf="selectedModelo && !isCreating" class="details-container fade-in">

      <div class="modelo-header">
        <div class="title-group">
          <h1>{{ selectedModelo.titulo }}</h1>
          <mat-chip-set>
            <mat-chip [color]="selectedModelo.ativo ? 'accent' : 'warn'" highlighted>
              {{ selectedModelo.ativo ? 'Ativo' : 'Inativo' }}
            </mat-chip>
          </mat-chip-set>
        </div>

        <div class="actions-group">
          <button mat-stroked-button color="primary" (click)="copyToClipboard()">
            <mat-icon>content_copy</mat-icon>
            Copiar JSON
          </button>

          <button mat-stroked-button color="warn" (click)="deleteCurrentModelo()">
            <mat-icon>delete</mat-icon>
            Excluir
          </button>
        </div>
      </div>

      <div class="meta-grid">
        <div class="meta-item">
          <span class="label">Jurisdição</span>
          <strong>{{ selectedModelo.jurisdicao }}</strong>
        </div>
        <div class="meta-item">
          <span class="label">Tipo de Ação</span>
          <strong>{{ selectedModelo.tipoAcao }}</strong>
        </div>
        <div class="meta-item">
          <span class="label">Última Atualização</span>
          <strong>{{ formatDate(selectedModelo.updatedAt) }}</strong>
        </div>
      </div>

      <mat-divider class="spacer"></mat-divider>

      <h3>Quesitos ({{ selectedModelo.quesitos?.length || 0 }})</h3>

      <mat-accordion multi>
        <mat-expansion-panel 
          *ngFor="let q of selectedModelo.quesitos"
          [expanded]="true" 
          hideToggle="true">
          
          <mat-expansion-panel-header>
            <mat-panel-title>
              <span class="order-badge">#{{ q.ordem }}</span>
              <span class="question-text">{{ q.texto }}</span>
            </mat-panel-title>
          </mat-expansion-panel-header>

          <div class="resposta-content">
            <h4>Resposta Padrão Sugerida:</h4>
            <p class="resposta-text">{{ q.respostaPadrao }}</p>
          </div>
        </mat-expansion-panel>
      </mat-accordion>
    </div>

    <div *ngIf="!selectedModelo && !isCreating" class="empty-state">
      <mat-icon class="large-icon">quiz</mat-icon>
      <h2>Gerenciador de Quesitos</h2>
      <p>Selecione um modelo na barra lateral para editar ou clique em "+" para adicionar.</p>
    </div>

  </mat-sidenav-content>
</mat-sidenav-container>