<div class="container">
  <header class="page-header">
    <h1>Gerenciador de Prompts</h1>
    <p>Configure os textos utilizados pela IA nas análises.</p>
  </header>

  <div class="actions-bar" *ngIf="!selectedPrompt()">
    <button mat-raised-button color="primary" (click)="editPrompt(null)">
      <mat-icon>add</mat-icon>
      Novo Prompt
    </button>
  </div>

  <div *ngIf="selectedPrompt() as prompt" class="edit-section">
    <mat-card class="edit-card">
      <mat-card-header>
        <mat-card-title>{{ prompt.id ? 'Editar Prompt' : 'Novo Prompt' }}</mat-card-title>
      </mat-card-header>
      
      <mat-card-content>
        <form #promptForm="ngForm" (ngSubmit)="savePrompt(prompt)">
          
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>ID do Prompt (Chave do Sistema)</mat-label>
            <input matInput 
                   [(ngModel)]="prompt.id" 
                   name="id" 
                   required 
                   [disabled]="isEditMode()" 
                   placeholder="Ex: analise_pericial_v1">
            <mat-hint *ngIf="!isEditMode()">Defina um ID único (sem espaços, use underlscore).</mat-hint>
            <mat-hint *ngIf="isEditMode()">O ID é a chave primária e não pode ser alterado.</mat-hint>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width mt-3">
            <mat-label>Nome do Prompt (Identificador Legível)</mat-label>
            <input matInput [(ngModel)]="prompt.nome" name="nome" required placeholder="Ex: Perícia Federal Padrão">
            <mat-hint>Nome amigável para identificar este prompt na lista.</mat-hint>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width mt-3">
            <mat-label>Texto do Prompt</mat-label>
            <textarea matInput [(ngModel)]="prompt.prompt_text" name="prompt_text" rows="15" required placeholder="Digite as instruções da IA aqui..."></textarea>
          </mat-form-field>

          <div class="form-actions">
            <button mat-button type="button" (click)="selectedPrompt.set(null)">Cancelar</button>
            <button mat-flat-button color="primary" type="submit" [disabled]="!promptForm.form.valid">
              Salvar Alterações
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="prompts-grid" *ngIf="!selectedPrompt()">
    @for (prompt of prompts(); track prompt.id) {
      <mat-card class="prompt-card" (click)="editPrompt(prompt)">
        <div class="card-content-wrapper">
          <div class="prompt-header">
            <div class="prompt-icon">
              <mat-icon>smart_toy</mat-icon>
            </div>
            <div class="prompt-title">
              <h3>{{ prompt.nome }}</h3>
              <span class="prompt-id-badge">{{ prompt.id }}</span>
            </div>
            <button mat-icon-button color="warn" (click)="deletePrompt(prompt.id, $event)" matTooltip="Excluir">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
          
          <mat-divider></mat-divider>
          
          <div class="prompt-preview">
            <p>{{ prompt.prompt_text }}</p>
          </div>
        </div>
        <div class="card-hover-action">
          <span>Clique para editar</span>
        </div>
      </mat-card>
    } @empty {
      <div class="empty-state">
        <mat-icon>text_fields</mat-icon>
        <p>Nenhum prompt encontrado.</p>
      </div>
    }
  </div>
</div>