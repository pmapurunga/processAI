<div class="container">

<mat-toolbar color="primary">
  <button mat-icon-button (click)="goBack()" matTooltip="Voltar">
    <mat-icon>arrow_back</mat-icon>
  </button>
  <span class="mat-h2">Documento Consolidado</span>
</mat-toolbar>
  

    @if (documento$ | async; as doc) {
      <mat-card class="page-card">
        <mat-card-header>
          <mat-card-title>{{ doc.tipoDocumentoGeral }}</mat-card-title>
          <mat-card-subtitle>Análise consolidada do processo judicial</mat-card-subtitle>
        </mat-card-header>
        
        <mat-card-content>
          <mat-list>
            <mat-list-item>
              <mat-icon matListItemIcon>fingerprint</mat-icon>
              <span matListItemTitle>ID do Documento</span>
              <span matListItemLine>{{ doc.idDocumento }}</span>
            </mat-list-item>
            <mat-divider></mat-divider>
            <mat-list-item>
              <mat-icon matListItemIcon>date_range</mat-icon>
              <span matListItemTitle>Período Analisado</span>
              <span matListItemLine>{{ doc.periodoAnalisado }}</span>
            </mat-list-item>
            <mat-divider></mat-divider>
            <mat-list-item>
              <mat-icon matListItemIcon>gavel</mat-icon>
              <span matListItemTitle>Tribunal</span>
              <span matListItemLine>{{ doc.dadosRelevantesParaLaudo.Tribunal }}</span>
            </mat-list-item>
             <mat-divider></mat-divider>
            <mat-list-item>
              <mat-icon matListItemIcon>account_balance</mat-icon>
              <span matListItemTitle>Vara</span>
              <span matListItemLine>{{ doc.dadosRelevantesParaLaudo.Vara }}</span>
            </mat-list-item>
          </mat-list>
        </mat-card-content>
      </mat-card>
  
      <mat-tab-group animationDuration="0ms" class="content-tabs">
        <!-- Resumo -->
        <mat-tab label="Resumo do Caso">
          <div class="tab-content">
            <h2 class="mat-h2">Resumo Geral do Caso</h2>
            <div class="mat-body-1" [innerHTML]="doc.dadosRelevantesParaLaudo.ResumoGeralDoCaso | safeHtml"></div>
          </div>
        </mat-tab>
  
        <!-- Partes -->
        <mat-tab label="Identificação das Partes">
          <div class="tab-content">
            <div class="party-section">
              <div class="party-column">
                <h3 class="party-title">Polo Ativo</h3>
                <mat-list>
                  <mat-list-item><strong>Nome:</strong> {{ doc.dadosRelevantesParaLaudo.identificacaoDasPartes.poloAtivo.nome }}</mat-list-item>
                  <mat-list-item><strong>CPF:</strong> {{ doc.dadosRelevantesParaLaudo.identificacaoDasPartes.poloAtivo.cpf }}</mat-list-item>
                  <mat-list-item><strong>Data de Nascimento:</strong> {{ doc.dadosRelevantesParaLaudo.identificacaoDasPartes.poloAtivo.dataNascimento }}</mat-list-item>
                  <mat-list-item><strong>Escolaridade:</strong> {{ doc.dadosRelevantesParaLaudo.identificacaoDasPartes.poloAtivo.escolaridade }}</mat-list-item>
                  <mat-list-item><strong>Estado Civil:</strong> {{ doc.dadosRelevantesParaLaudo.identificacaoDasPartes.poloAtivo.estadoCivil }}</mat-list-item>
                  <mat-list-item><strong>Dados Consolidados:</strong> {{ doc.dadosRelevantesParaLaudo.identificacaoDasPartes.poloAtivo.dadosPessoaisConsolidados }}</mat-list-item>
                </mat-list>
              </div>
              <div class="party-column">
                <h3 class="party-title">Polo Passivo</h3>
                <mat-list>
                  <mat-list-item><strong>Nome:</strong> {{ doc.dadosRelevantesParaLaudo.identificacaoDasPartes.poloPassivo.nome }}</mat-list-item>
                  <mat-list-item><strong>CNPJ:</strong> {{ doc.dadosRelevantesParaLaudo.identificacaoDasPartes.poloPassivo.cnpj }}</mat-list-item>
                  <mat-list-item><strong>Dados Consolidados:</strong> {{ doc.dadosRelevantesParaLaudo.identificacaoDasPartes.poloPassivo.dadosGeraisConsolidados }}</mat-list-item>
                </mat-list>
              </div>
            </div>
          </div>
        </mat-tab>
  
        <!-- Histórico Ocupacional -->
        <mat-tab label="Histórico Ocupacional">
          <div class="tab-content">
            @for (item of doc.historicoOcupacionalConsolidado; track item.empresa) {
              <mat-card class="nested-card">
                <mat-card-header>
                  <mat-card-title>{{ item.ocupacao }} em {{ item.empresa }}</mat-card-title>
                  <mat-card-subtitle>Período: {{ item.periodoFuncao }} | Tipo: {{ item.tipoOcupacao }}</mat-card-subtitle>
                </mat-card-header>
                <mat-card-content class="mat-body-1">
                  <p><strong>Descrição da Função:</strong> {{ item.descricaoFuncao }}</p>
                  <mat-chip-listbox aria-label="Ambiente de trabalho">
                    <mat-chip-option color="accent" selected>Amb. Físico: {{ item.ambienteFisico }}</mat-chip-option>
                    <mat-chip-option color="accent" selected>Amb. Psicossocial: {{ item.ambientePsicossocial }}</mat-chip-option>
                  </mat-chip-listbox>
                </mat-card-content>
              </mat-card>
            } @empty {
              <p class="mat-body-1">Nenhum histórico ocupacional encontrado.</p>
            }
          </div>
        </mat-tab>
  
        <!-- Documentos Médicos -->
        <mat-tab label="Documentos Médicos ({{ doc.documentosMedicosAnexados.length }})">
          <div class="tab-content">
            <mat-list>
              @for (medDoc of doc.documentosMedicosAnexados; track $index) {
                <mat-list-item>
                  <mat-icon matListItemIcon>description</mat-icon>
                  <div matListItemTitle><strong>{{ medDoc.tipo }}</strong> - {{ medDoc.data }}</div>
                  <div matListItemLine><span>{{ medDoc.profissionalServico }} (Pág. {{ medDoc.paginaNoArquivo }})</span></div>
                  <div matListItemLine><span>{{ medDoc.resumoConteudo }}</span></div>
                </mat-list-item>
                <mat-divider></mat-divider>
              } @empty {
                <p class="mat-body-1">Nenhum documento médico encontrado.</p>
              }
            </mat-list>
          </div>
        </mat-tab>
        
      </mat-tab-group>
  
    } @else {
      <div class="loading-container">
          <p class="mat-body-1">Carregando documento consolidado...</p>
          <mat-progress-bar mode="indeterminate"></mat-progress-bar>
      </div>
    }
  </div>
  