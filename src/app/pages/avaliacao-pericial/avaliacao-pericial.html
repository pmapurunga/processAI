<div class="container">
  <h1>Formulário de Avaliação Pericial</h1>

  <form [formGroup]="form" (ngSubmit)="save()">
    <!-- Seção de Identificação do Processo -->
    <mat-card formGroupName="identificacaoProcesso">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>gavel</mat-icon>
          Identificação do Processo
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="form-grid">
          <mat-form-field appearance="outline">
            <mat-label>Número do Processo</mat-label>
            <input matInput formControlName="PROCESSO_NUM" placeholder="Ex: 0001234-56.2023.8.26.0001">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Juízo</mat-label>
            <input matInput formControlName="JUIZO" placeholder="Ex: 1ª Vara Cível de São Paulo">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Nome do Periciando</mat-label>
            <input matInput formControlName="NOME_PERICIANDO" placeholder="Nome completo">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Data do Exame</mat-label>
            <input matInput [matDatepicker]="dataExamePicker" formControlName="DATA_EXAME">
            <mat-datepicker-toggle matSuffix [for]="dataExamePicker"></mat-datepicker-toggle>
            <mat-datepicker #dataExamePicker></mat-datepicker>
          </mat-form-field>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Seção de Dados do Periciando -->
    <mat-card formGroupName="dadosPericiando">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>person</mat-icon>
          Dados do Periciando
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="form-grid">
          <mat-form-field appearance="outline">
            <mat-label>Data de Nascimento</mat-label>
            <input matInput [matDatepicker]="dataNascimentoPicker" formControlName="DATA_NASCIMENTO">
            <mat-datepicker-toggle matSuffix [for]="dataNascimentoPicker"></mat-datepicker-toggle>
            <mat-datepicker #dataNascimentoPicker></mat-datepicker>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Sexo</mat-label>
            <mat-select formControlName="SEXO">
              <mat-option value="Masculino">Masculino</mat-option>
              <mat-option value="Feminino">Feminino</mat-option>
              <mat-option value="Outro">Outro</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Estado Civil</mat-label>
            <mat-select formControlName="ESTADO_CIVIL">
              <mat-option value="Solteiro(a)">Solteiro(a)</mat-option>
              <mat-option value="Casado(a)">Casado(a)</mat-option>
              <mat-option value="Divorciado(a)">Divorciado(a)</mat-option>
              <mat-option value="Viúvo(a)">Viúvo(a)</mat-option>
              <mat-option value="União Estável">União Estável</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Escolaridade</mat-label>
            <mat-select formControlName="ESCOLARIDADE">
              <mat-option value="Ensino Fundamental Incompleto">Ensino Fundamental Incompleto</mat-option>
              <mat-option value="Ensino Fundamental Completo">Ensino Fundamental Completo</mat-option>
              <mat-option value="Ensino Médio Incompleto">Ensino Médio Incompleto</mat-option>
              <mat-option value="Ensino Médio Completo">Ensino Médio Completo</mat-option>
              <mat-option value="Ensino Superior Incompleto">Ensino Superior Incompleto</mat-option>
              <mat-option value="Ensino Superior Completo">Ensino Superior Completo</mat-option>
              <mat-option value="Pós-graduação">Pós-graduação</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Seção de Histórico Laboral -->
    <mat-card formGroupName="historicoLaboral">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>work</mat-icon>
          Histórico Laboral
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div formGroupName="FUNCAO_HABITUAL_ATUAL">
          <h3>
            <mat-icon>work_history</mat-icon>
            Função Habitual Atual
          </h3>
          <div class="form-grid">
            <mat-form-field appearance="outline">
              <mat-label>Descrição da Função</mat-label>
              <input matInput formControlName="descricao" placeholder="Descreva a função atual">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Vínculo</mat-label>
              <mat-select formControlName="vinculo">
                <mat-option value="CLT">CLT</mat-option>
                <mat-option value="Estatutário">Estatutário</mat-option>
                <mat-option value="Autônomo">Autônomo</mat-option>
                <mat-option value="Terceirizado">Terceirizado</mat-option>
                <mat-option value="Outros">Outros</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Período</mat-label>
              <input matInput formControlName="periodo" placeholder="Ex: Jan/2020 - Atual">
            </mat-form-field>
          </div>
        </div>

        <mat-divider class="my-4"></mat-divider>

        <div class="form-grid">
          <mat-form-field appearance="outline">
            <mat-label>Tempo Total de Atividade</mat-label>
            <input matInput formControlName="TEMPO_TOTAL_ATIVIDADE" placeholder="Ex: 5 anos e 3 meses">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Data de Afastamento Declarada</mat-label>
            <input matInput [matDatepicker]="dataAfastamentoPicker" formControlName="DATA_AFASTAMENTO_DECLARADA">
            <mat-datepicker-toggle matSuffix [for]="dataAfastamentoPicker"></mat-datepicker-toggle>
            <mat-datepicker #dataAfastamentoPicker></mat-datepicker>
          </mat-form-field>
        </div>

        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Histórico Ocupacional Completo</mat-label>
          <textarea matInput formControlName="HISTORICO_OCUPACIONAL_COMPLETO" 
                    rows="4" placeholder="Descreva o histórico ocupacional completo"></textarea>
        </mat-form-field>

        <div formArrayName="EXPERIENCIAS_LABORAIS_ANTERIORES">
          <h3>
            <mat-icon>history</mat-icon>
            Experiências Laborais Anteriores
          </h3>
          
          <div *ngFor="let exp of $any(form.get('historicoLaboral.EXPERIENCIAS_LABORAIS_ANTERIORES')).controls; let i = index" 
               [formGroupName]="i" class="experience-array-item mat-elevation-z1">
            <h4>
              <mat-icon>work_outline</mat-icon>
              Experiência {{ i + 1 }}
            </h4>
            <div class="form-grid">
              <mat-form-field appearance="outline">
                <mat-label>Descrição</mat-label>
                <input matInput formControlName="descricao" placeholder="Descreva a experiência">
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Vínculo</mat-label>
                <mat-select formControlName="vinculo">
                  <mat-option value="CLT">CLT</mat-option>
                  <mat-option value="Estatutário">Estatutário</mat-option>
                  <mat-option value="Autônomo">Autônomo</mat-option>
                  <mat-option value="Terceirizado">Terceirizado</mat-option>
                  <mat-option value="Outros">Outros</mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Período</mat-label>
                <input matInput formControlName="periodo" placeholder="Ex: Jan/2018 - Dez/2019">
              </mat-form-field>
            </div>
            <div class="form-actions-secondary">
              <button mat-icon-button color="warn" type="button" (click)="removeExperiencia(i)" *ngIf="podeRemoverExperiencia()">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>
          
          <div class="form-actions-secondary">
            <button mat-stroked-button color="primary" type="button" (click)="adicionarExperiencia()">
              <mat-icon>add</mat-icon>
              Adicionar Experiência
            </button>
          </div>
        </div>

        <div formGroupName="PROFISSIOGRAFIA">
          <h3>
            <mat-icon>assessment</mat-icon>
            Profissiografia
          </h3>
          <div class="form-grid">
            <mat-form-field appearance="outline">
              <mat-label>Atividade Analisada</mat-label>
              <input matInput formControlName="atividade_analisada" placeholder="Descreva a atividade analisada">
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Tarefas Executadas</mat-label>
              <textarea matInput formControlName="tarefas_executadas" rows="4" 
                        placeholder="Descreva as tarefas executadas"></textarea>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Postura Corporal</mat-label>
              <input matInput formControlName="postura_corporal" placeholder="Descreva a postura corporal">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Movimentos Repetitivos</mat-label>
              <input matInput formControlName="movimentos_repetitivos" placeholder="Descreva os movimentos repetitivos">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Carga Física</mat-label>
              <input matInput formControlName="carga_fisica" placeholder="Descreva a carga física">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Ambiente de Trabalho</mat-label>
              <input matInput formControlName="ambiente_trabalho" placeholder="Descreva o ambiente de trabalho">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Exigências Físicas</mat-label>
              <input matInput formControlName="exigencias_fisicas" placeholder="Descreva as exigências físicas">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Equipamentos Utilizados</mat-label>
              <input matInput formControlName="equipamentos_utilizados" placeholder="Liste os equipamentos utilizados">
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Sumário Profissiográfico</mat-label>
              <textarea matInput formControlName="SUMARIO_PROFISSIOGRAFICO" rows="4"
                        placeholder="Descreva o sumário profissiográfico"></textarea>
            </mat-form-field>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Seção de Dados Médicos -->
    <mat-card formGroupName="dadosMedicos">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>medical_services</mat-icon>
          Dados Médicos
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>História Clínica</mat-label>
          <textarea matInput formControlName="HISTORIA_CLINICA" 
                    rows="4" placeholder="Descreva a história clínica do periciando"></textarea>
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Exames</mat-label>
          <textarea matInput formControlName="EXAMES" 
                    rows="4" placeholder="Liste os exames realizados"></textarea>
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Exame Clínico</mat-label>
          <textarea matInput formControlName="EXAME_CLINICO" 
                    rows="4" placeholder="Descreva os resultados do exame clínico"></textarea>
        </mat-form-field>
      </mat-card-content>
    </mat-card>

    <!-- Seção de Dados do Laudo -->
    <mat-card formGroupName="dadosLaudo">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>description</mat-icon>
          Dados do Laudo
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="form-grid">
          <mat-form-field appearance="outline">
            <mat-label>Dia do Laudo</mat-label>
            <input matInput formControlName="DIA_LAUDO" placeholder="Ex: 07">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Mês do Laudo</mat-label>
            <mat-select formControlName="MES_LAUDO">
              <mat-option value="Janeiro">Janeiro</mat-option>
              <mat-option value="Fevereiro">Fevereiro</mat-option>
              <mat-option value="Março">Março</mat-option>
              <mat-option value="Abril">Abril</mat-option>
              <mat-option value="Maio">Maio</mat-option>
              <mat-option value="Junho">Junho</mat-option>
              <mat-option value="Julho">Julho</mat-option>
              <mat-option value="Agosto">Agosto</mat-option>
              <mat-option value="Setembro">Setembro</mat-option>
              <mat-option value="Outubro">Outubro</mat-option>
              <mat-option value="Novembro">Novembro</mat-option>
              <mat-option value="Dezembro">Dezembro</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Ano do Laudo</mat-label>
            <input matInput formControlName="ANO_LAUDO" placeholder="Ex: 2025">
          </mat-form-field>
        </div>
      </mat-card-content>
    </mat-card>

    <div class="form-actions">
      <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid">
        <mat-icon>save</mat-icon>
        Salvar Alterações
      </button>
    </div>
  </form>
</div>